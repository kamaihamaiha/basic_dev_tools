## 基本概念

- 版本库
- Git 对象类型
- 索引
- 可寻址内容名称
- Git 追踪内容
- 路径名与内容
- 打包文件

---

### 版本库

Git 版本库是一个简单的数据库，包含所有用来维护和管理项目的 **修订版本** 和 **历史**   

- 提供副本
  - 提供版本库中所有文件的副本  
  - 提供版本库本身的副本
- 维护对象（数据结构）
  - 对象库：object store
  - 索引：index
- .git
  - 版本库数据存放在工作目录下的这个目录中


### Git 对象类型

#### 对象库是 Git 版本库实现的心脏

- 原始数据文件
- 所有日志消息
- 作业信息
- 日期
- 其他用来重建项目任意版本或者分支的信息

#### 对象库类型

- blob
- tree
- commit
- tag

##### blob（块）

- 文件的每一个版本表示一个块
- binary large object
  - 二进制大对象
  - 计算机领域的常用术语
  - 用来指代某些可以包含任意数据的**变量** 或 **文件**
  - 内部结构会被程序忽略
  - 一个 blob 被视为一个黑盒
  - 保存文件的数据，单不包含任何关于这个文件的元数据，甚至连文件名也没有

##### tree（目录树）

- 一个目录树对象代表一层目录信息
- 它记录 blob 标识符、路径名、在一个目录里所有文件的一些元数据         
- 它可以
  - 递归引用 其他目录树或者子树对象
  - 从而建立一个 包含文件和子目录的 完整层级结构

##### commit（提交）

- 保存
  - 版本库中每一次变化的元数据
    - 作者
    - 提交者
    - 提交日期
    - 日志消息
- 指向
  - 每一个提交对象指向一个目录树对象
  - 这个目录树对象在一张完整的快照中，捕获提交时版本库的状态
- 父提交
  - 最初的提交或者跟提交(root commit)没有父提交
  - 大多数提交都有父提交


##### tag（标签）

分配人类可读的名字给一个特定对象，通常是提交对象。

### 索引

#### 概念

- 临时的、动态的二进制文件
- 描述整个版本库的目录结构
- 更具体的说：捕获项目在某个时刻的整体结构的一个版本

#### 特色

开发的进度和提交的变更可以分离

#### 工作原理

- 通过 Git 命令在索引中暂存（stage）变更
  - 变更通常是：添加、删除、编辑
- 索引会记录和保存哪些变更
  - 保障他们的安全，知道你准备提交了


### 可寻址内容名称

- Git 对象库被组织及实现成一个 内容寻址的存储系统
- 对象库中的每一个对象都有一个唯一的名字
  - SHA1 散列值
    - 是向 对象的内容 应用 SHA1 得到的
- 依据
  - 一个对象的完整内容决定了这个散列值
  - 这个散列值能有效并唯一地对应特定的内容
  - 文件的任何微小变化都会导致 SHA1 散列值的改变
    - 使得文件的新版本被单独编入索引
- SHA1 
  - 160 位 二进制数
  - 通常用 40 位 16进制数 表示
  - 简化
    - 有时候会简化成一个较小的、唯一的前缀
  - 同一个东西
    - SHA1
    - 散列码
    - 对象ID

### Git 追踪内容

- 还是一个内容追踪系统（content tracking system）
- 2 种关键方式
  - Git 对象库基于对象内容的 散列值
    - 和文件名、目录没有关系
  - 存储每个文件的每个版本
    - 而不是差异

### 路径名与内容

Git 把文件名视为一段区别与文件内容的数据，这样就把索引从传统数据库的数据中分离出来了。

#### 数据库对比

| 系统          | 索引机制                        | 数据存储          |
| ------------- | ------------------------------- | ----------------- |
| 传统数据库    | 索引顺序存取方法（ISAM）        | 数据记录          |
| UNIX 文件系统 | 目录（/path/to/file）           | 数据块            |
| Git           | `.git/objects/hash`、树对象内容 | blob 对象、树对象 |

### 打包文件

一种高效的存储机制

#### 原理

- 定位内容非常相似的全部文件
- 找到其中一个，存储整个内容
- 计算其他相似文件之间的差异
- 只存储差异